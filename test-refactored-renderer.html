<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎯 Test Renderer Refactorizado - Hito 1A</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
        }
        
        #gameCanvas {
            border: 2px solid #333;
            background: radial-gradient(ellipse at center, #000033 0%, #000011 70%, #000000 100%);
        }
        
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            background: #333;
            color: #fff;
            border: 1px solid #666;
            cursor: pointer;
            font-family: inherit;
        }
        
        button:hover {
            background: #555;
        }
        
        .debug-panel {
            margin-top: 20px;
            padding: 15px;
            background: #111;
            border: 1px solid #333;
            font-size: 12px;
        }
        
        .debug-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .debug-label {
            color: #888;
        }
        
        .debug-value {
            color: #0f0;
        }
        
        .status-ok { color: #0f0; }
        .status-error { color: #f00; }
        .status-warning { color: #fa0; }
        
        .fleet-triangle {
            transition: none; /* Sin transiciones para debug */
        }
    </style>
</head>
<body>
    <h1>🎯 Test Renderer Refactorizado - Hito 1A</h1>
    <p>Verificando que el renderer refactorizado funciona igual que test-hito1a.html</p>
    
    <div class="controls">
        <button onclick="testSimpleOrientation()">🎯 Test Orientación Simple</button>
        <button onclick="testMovingShip()">🚀 Test Nave en Movimiento</button>
        <button onclick="resetTest()">🔄 Reset</button>
    </div>
    
    <svg id="gameCanvas" width="800" height="600"></svg>
    
    <div class="debug-panel">
        <h3>📊 Estado del Test</h3>
        <div class="debug-row">
            <span class="debug-label">Estado:</span>
            <span id="gameStatus" class="debug-value">Detenido</span>
        </div>
        <div class="debug-row">
            <span class="debug-label">Naves:</span>
            <span id="shipCount" class="debug-value">0</span>
        </div>
        <div class="debug-row">
            <span class="debug-label">Ángulo Actual:</span>
            <span id="currentAngle" class="debug-value">0°</span>
        </div>
        <div class="debug-row">
            <span class="debug-label">Posición:</span>
            <span id="currentPosition" class="debug-value">(0, 0)</span>
        </div>
        <div class="debug-row">
            <span class="debug-label">Destino:</span>
            <span id="targetPosition" class="debug-value">(0, 0)</span>
        </div>
    </div>

    <script type="module">
        // Importar clases necesarias
        import { Fleet } from './src/entities/Fleet.js';
        import { Renderer } from './src/visual/Renderer.js';
        
        // Variables globales
        let testFleet = null;
        let renderer = null;
        let animationId = null;
        let mockGameEngine = null;
        
        // Elementos del DOM
        const gameStatusEl = document.getElementById('gameStatus');
        const shipCountEl = document.getElementById('shipCount');
        const currentAngleEl = document.getElementById('currentAngle');
        const currentPositionEl = document.getElementById('currentPosition');
        const targetPositionEl = document.getElementById('targetPosition');
        
        /**
         * Mock del GameEngine para el test
         */
        class MockGameEngine {
            constructor() {
                this.fleets = new Map();
                this.planets = new Map();
                
                // Crear planetas de prueba
                this.planets.set('planet1', {
                    id: 'planet1',
                    x: 150,
                    y: 300,
                    radius: 20,
                    color: '#666',
                    owner: 'neutral',
                    ships: 10
                });
                
                this.planets.set('planet2', {
                    id: 'planet2',
                    x: 650,
                    y: 200,
                    radius: 25,
                    color: '#888',
                    owner: 'neutral',
                    ships: 15
                });
            }
            
            getPlanet(planetId) {
                return this.planets.get(planetId);
            }
            
            getRenderData() {
                return {
                    planets: Array.from(this.planets.values()),
                    fleets: Array.from(this.fleets.values()).map(f => f.getRenderData())
                };
            }
            
            addFleet(fleet) {
                this.fleets.set(fleet.id, fleet);
            }
            
            removeFleet(fleetId) {
                this.fleets.delete(fleetId);
            }
        }
        
        /**
         * Inicializar test
         */
        function initTest() {
            mockGameEngine = new MockGameEngine();
            renderer = new Renderer(mockGameEngine);
            renderer.start();
            
            console.log('🎯 Test inicializado');
        }
        
        /**
         * Test de orientación simple (nave estática apuntando al destino)
         */
        window.testSimpleOrientation = function() {
            resetTest();
            
            gameStatusEl.textContent = 'Test Orientación Simple';
            gameStatusEl.className = 'debug-value status-ok';
            
            // Crear flota de prueba
            const fleetData = {
                id: 'test-fleet-1',
                ships: 5,
                owner: 'player',
                fromPlanet: 'planet1',
                toPlanet: 'planet2',
                startX: 150,
                startY: 300,
                targetX: 650,
                targetY: 200,
                launchTime: Date.now()
            };
            
            testFleet = new Fleet(fleetData);
            mockGameEngine.addFleet(testFleet);
            
            // Actualizar debug info
            updateDebugInfo();
            
            console.log('🎯 Test orientación simple iniciado');
        };
        
        /**
         * Test de nave en movimiento
         */
        window.testMovingShip = function() {
            resetTest();
            
            gameStatusEl.textContent = 'Test Nave en Movimiento';
            gameStatusEl.className = 'debug-value status-ok';
            
            // Crear flota de prueba
            const fleetData = {
                id: 'test-fleet-2',
                ships: 3,
                owner: 'player',
                fromPlanet: 'planet1',
                toPlanet: 'planet2',
                startX: 150,
                startY: 300,
                targetX: 650,
                targetY: 200,
                launchTime: Date.now()
            };
            
            testFleet = new Fleet(fleetData);
            mockGameEngine.addFleet(testFleet);
            
            // Iniciar animación
            startAnimation();
            
            console.log('🎯 Test nave en movimiento iniciado');
        };
        
        /**
         * Iniciar animación
         */
        function startAnimation() {
            function animate() {
                if (testFleet && !testFleet.hasArrived) {
                    // Actualizar flota
                    testFleet.update(16); // ~60 FPS
                    
                    // Actualizar debug info
                    updateDebugInfo();
                    
                    animationId = requestAnimationFrame(animate);
                } else {
                    gameStatusEl.textContent = 'Animación Completada';
                    gameStatusEl.className = 'debug-value status-warning';
                }
            }
            
            animate();
        }
        
        /**
         * Actualizar información de debug
         */
        function updateDebugInfo() {
            if (testFleet) {
                shipCountEl.textContent = '1'; // Una nave por flota
                
                // Calcular ángulo actual (igual que en el renderer)
                const dx = testFleet.targetX - testFleet.x;
                const dy = testFleet.targetY - testFleet.y;
                const angle = Math.atan2(dy, dx) * (180 / Math.PI);
                
                currentAngleEl.textContent = `${Math.round(angle)}°`;
                currentPositionEl.textContent = `(${Math.round(testFleet.x)}, ${Math.round(testFleet.y)})`;
                targetPositionEl.textContent = `(${testFleet.targetX}, ${testFleet.targetY})`;
            }
        }
        
        /**
         * Reset del test
         */
        window.resetTest = function() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            if (testFleet) {
                mockGameEngine.removeFleet(testFleet.id);
                testFleet = null;
            }
            
            // Limpiar canvas
            const canvas = document.getElementById('gameCanvas');
            while (canvas.firstChild) {
                canvas.removeChild(canvas.firstChild);
            }
            
            // Reinicializar renderer
            if (renderer) {
                renderer.destroy();
            }
            initTest();
            
            gameStatusEl.textContent = 'Detenido';
            gameStatusEl.className = 'debug-value';
            
            shipCountEl.textContent = '0';
            currentAngleEl.textContent = '0°';
            currentPositionEl.textContent = '(0, 0)';
            targetPositionEl.textContent = '(0, 0)';
            
            console.log('🔄 Test reiniciado');
        };
        
        // Inicializar al cargar la página
        document.addEventListener('DOMContentLoaded', initTest);
    </script>
</body>
</html> 