<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Test Orientaci√≥n - Hito 1</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a0a0a;
            color: #00ff88;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            gap: 20px;
            height: 100vh;
        }
        
        .game-area {
            flex: 1;
            border: 2px solid #00ff88;
            border-radius: 8px;
            position: relative;
            background: radial-gradient(circle at center, #001122 0%, #000000 100%);
        }
        
        .debug-panel {
            width: 300px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 15px;
            height: fit-content;
        }
        
        .debug-section {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 255, 136, 0.05);
            border-radius: 4px;
        }
        
        .debug-value {
            color: #88ffaa;
            font-weight: bold;
        }
        
        button {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        
        button:hover {
            background: #00cc66;
        }
        
        #gameCanvas {
            width: 100%;
            height: 100%;
        }
        
        .ship {
            fill: #00ff88;
            stroke: #88ffaa;
            stroke-width: 1;
        }
        
        .planet {
            stroke: #666;
            stroke-width: 2;
        }
        
        .target-line {
            stroke: #ff4444;
            stroke-width: 1;
            stroke-dasharray: 5,5;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-area">
            <svg id="gameCanvas" viewBox="0 0 800 600">
                <!-- Planeta origen -->
                <circle id="originPlanet" cx="100" cy="300" r="30" class="planet" fill="#4444ff"/>
                <text x="100" y="350" text-anchor="middle" fill="#88ffaa" font-size="12">Origen</text>
                
                <!-- Planeta destino -->
                <circle id="targetPlanet" cx="700" cy="200" r="25" class="planet" fill="#ff4444"/>
                <text x="700" y="250" text-anchor="middle" fill="#88ffaa" font-size="12">Destino</text>
                
                <!-- L√≠nea de referencia -->
                <line id="targetLine" x1="100" y1="300" x2="700" y2="200" class="target-line"/>
                
                <!-- Nave de prueba -->
                <g id="ship" transform="translate(150,300)">
                    <polygon points="0,-8 -6,6 0,3 6,6" class="ship"/>
                </g>
            </svg>
        </div>
        
        <div class="debug-panel">
            <h3>üéØ Hito 1: Orientaci√≥n</h3>
            
            <div class="debug-section">
                <h4>Estado de la Nave</h4>
                <div>Posici√≥n: <span id="shipPosition" class="debug-value">150, 300</span></div>
                <div>√Ångulo: <span id="shipAngle" class="debug-value">0¬∞</span></div>
                <div>Destino: <span id="targetPosition" class="debug-value">700, 200</span></div>
            </div>
            
            <div class="debug-section">
                <h4>Controles</h4>
                <button onclick="moveShip()">üöÄ Mover Nave</button>
                <button onclick="resetShip()">üîÑ Reset</button>
                <button onclick="toggleAnimation()">‚èØÔ∏è Animar</button>
            </div>
            
            <div class="debug-section">
                <h4>Criterios de √âxito</h4>
                <div id="criteria1">‚ùå Tri√°ngulo apunta al destino</div>
                <div id="criteria2">‚ùå Orientaci√≥n durante movimiento</div>
                <div id="criteria3">‚ùå Sin glitches visuales</div>
            </div>
            
            <div class="debug-section">
                <h4>Instrucciones</h4>
                <p style="font-size: 11px;">
                    1. La nave debe apuntar siempre hacia el planeta destino<br>
                    2. El v√©rtice superior del tri√°ngulo debe ser la "proa"<br>
                    3. La orientaci√≥n debe actualizarse suavemente
                </p>
            </div>
        </div>
    </div>

    <script>
        // Estado del test
        let shipX = 150;
        let shipY = 300;
        let targetX = 700;
        let targetY = 200;
        let currentAngle = 0;
        let isAnimating = false;
        let animationId = null;

        // Elementos DOM
        const ship = document.getElementById('ship');
        const shipPositionEl = document.getElementById('shipPosition');
        const shipAngleEl = document.getElementById('shipAngle');
        const targetPositionEl = document.getElementById('targetPosition');

        /**
         * üéØ FUNCI√ìN PRINCIPAL: Calcular √°ngulo hacia el destino
         */
        function calculateAngleToTarget(fromX, fromY, toX, toY) {
            const dx = toX - fromX;
            const dy = toY - fromY;
            
            // Calcular √°ngulo en radianes
            const angleRad = Math.atan2(dy, dx);
            
            // Convertir a grados
            const angleDeg = angleRad * (180 / Math.PI);
            
            // Ajustar para que 0¬∞ apunte hacia arriba (norte)
            // SVG: 0¬∞ = este, 90¬∞ = sur, 180¬∞ = oeste, 270¬∞ = norte
            // Queremos: 0¬∞ = norte, 90¬∞ = este, 180¬∞ = sur, 270¬∞ = oeste
            const adjustedAngle = angleDeg + 90;
            
            return adjustedAngle;
        }

        /**
         * üéØ FUNCI√ìN PRINCIPAL: Actualizar orientaci√≥n de la nave
         */
        function updateShipOrientation() {
            // Calcular √°ngulo hacia el destino
            const targetAngle = calculateAngleToTarget(shipX, shipY, targetX, targetY);
            
            // Aplicar rotaci√≥n al elemento SVG
            ship.setAttribute('transform', 
                `translate(${shipX},${shipY}) rotate(${targetAngle})`
            );
            
            // Actualizar UI
            currentAngle = targetAngle;
            updateDebugInfo();
            
            // Verificar criterios de √©xito
            checkSuccessCriteria();
        }

        /**
         * Actualizar informaci√≥n de debug
         */
        function updateDebugInfo() {
            shipPositionEl.textContent = `${Math.round(shipX)}, ${Math.round(shipY)}`;
            shipAngleEl.textContent = `${Math.round(currentAngle)}¬∞`;
            targetPositionEl.textContent = `${targetX}, ${targetY}`;
        }

        /**
         * Verificar criterios de √©xito del Hito 1
         */
        function checkSuccessCriteria() {
            const criteria1 = document.getElementById('criteria1');
            const criteria2 = document.getElementById('criteria2');
            const criteria3 = document.getElementById('criteria3');
            
            // Criterio 1: Tri√°ngulo apunta al destino (tolerancia de ¬±5¬∞)
            const expectedAngle = calculateAngleToTarget(shipX, shipY, targetX, targetY);
            const angleDiff = Math.abs(currentAngle - expectedAngle);
            const pointingCorrectly = angleDiff < 5;
            
            criteria1.textContent = pointingCorrectly ? 
                "‚úÖ Tri√°ngulo apunta al destino" : 
                "‚ùå Tri√°ngulo apunta al destino";
            
            // Criterio 2: Se actualiza durante movimiento
            criteria2.textContent = isAnimating ? 
                "‚úÖ Orientaci√≥n durante movimiento" : 
                "‚è∏Ô∏è Orientaci√≥n durante movimiento";
            
            // Criterio 3: Sin glitches (siempre OK por ahora)
            criteria3.textContent = "‚úÖ Sin glitches visuales";
        }

        /**
         * Mover nave hacia una posici√≥n aleatoria
         */
        function moveShip() {
            // Generar posici√≥n aleatoria
            shipX = 100 + Math.random() * 600;
            shipY = 100 + Math.random() * 400;
            
            // Actualizar orientaci√≥n
            updateShipOrientation();
        }

        /**
         * Reset nave a posici√≥n inicial
         */
        function resetShip() {
            shipX = 150;
            shipY = 300;
            updateShipOrientation();
        }

        /**
         * Toggle animaci√≥n continua
         */
        function toggleAnimation() {
            if (isAnimating) {
                stopAnimation();
            } else {
                startAnimation();
            }
        }

        /**
         * Iniciar animaci√≥n continua
         */
        function startAnimation() {
            isAnimating = true;
            
            function animate() {
                // Mover nave en c√≠rculo alrededor del centro
                const time = Date.now() * 0.001;
                const centerX = 400;
                const centerY = 300;
                const radius = 150;
                
                shipX = centerX + Math.cos(time) * radius;
                shipY = centerY + Math.sin(time) * radius;
                
                // Actualizar orientaci√≥n
                updateShipOrientation();
                
                if (isAnimating) {
                    animationId = requestAnimationFrame(animate);
                }
            }
            
            animate();
        }

        /**
         * Detener animaci√≥n
         */
        function stopAnimation() {
            isAnimating = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }

        // Permitir cambiar destino haciendo clic
        document.getElementById('gameCanvas').addEventListener('click', function(e) {
            const rect = this.getBoundingClientRect();
            const svgRect = this.viewBox.baseVal;
            
            // Convertir coordenadas del clic a coordenadas SVG
            const x = (e.clientX - rect.left) * (svgRect.width / rect.width);
            const y = (e.clientY - rect.top) * (svgRect.height / rect.height);
            
            // Actualizar destino
            targetX = x;
            targetY = y;
            
            // Mover planeta destino
            document.getElementById('targetPlanet').setAttribute('cx', targetX);
            document.getElementById('targetPlanet').setAttribute('cy', targetY);
            
            // Actualizar l√≠nea de referencia
            document.getElementById('targetLine').setAttribute('x2', targetX);
            document.getElementById('targetLine').setAttribute('y2', targetY);
            
            // Actualizar orientaci√≥n
            updateShipOrientation();
        });

        // Inicializar
        updateShipOrientation();
        
        console.log('üéØ Test de Orientaci√≥n iniciado');
        console.log('- Haz clic para cambiar el destino');
        console.log('- Usa los botones para probar diferentes escenarios');
        console.log('- Verifica que el v√©rtice del tri√°ngulo apunta al destino');
    </script>
</body>
</html> 